<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head th:replace="fragments/head :: head(title='Home')"></head>

<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>

<body>
<!-- Include the navbar -->
<div th:replace="fragments/navbar :: navbar"></div>

<div class="container mt-4">
    <div class="row">
        <!-- Left Section: Personal Profile (1/3 of the page) -->
        <div class="col-md-4">
            <div class="card">
                <img src="/images/avatar.jpg" class="card-img-top rounded-circle mx-auto d-block mt-3" style="width: 100px;" alt="Profile Avatar">
                <div class="card-body text-center">
                    <a href="#"> <h5 class="card-title">Your Name</h5> </a>
                    <p class="card-text">Your basic information (e.g., job title, location)</p>
                    <a href="#" class="btn btn-primary btn-sm">View Profile</a>
                </div>
            </div>
        </div>

        <!-- Right Section: Post Writing (2/3 of the page) -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Write a Post</h5>
                    <form id="postForm">
                        <div class="form-group">
                            <!-- Quill Editor -->
                            <div id="editor-container" style="height: 200px;"></div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Post</button>
                    </form>
                </div>
            </div>

            <!-- Posts Section -->
            <div id="posts-section" class="mt-4">
                <!-- New posts will appear here dynamically -->
            </div>
        </div>
    </div>
</div>

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, false] }],
                ['bold', 'italic', 'blockquote'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'image'],
                [{ 'align': [] }],
                ['code-block'],
            ]
        }
    });

    // Handle the form submission via AJAX
    document.getElementById('postForm').addEventListener('submit', function(event) {
        event.preventDefault();  // Prevent the form from submitting the normal way
        var postContent = quill.root.innerHTML;  // Get the HTML content from the editor

        // Make AJAX request to submit the post
        fetch('/posts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': '[YOUR_CSRF_TOKEN_HERE]'  // Use Thymeleaf to generate this token
            },
            body: JSON.stringify({
                content: postContent
            })
        })
            .then(response => response.json())
            .then(data => {
                // Append the new post to the posts section
                var postElement = createPostElement(data);
                document.getElementById('posts-section').prepend(postElement);  // Add new post at the top
            })
            .catch(error => console.error('Error:', error));
    });

    // Function to create a post element to display dynamically
    function createPostElement(post) {
        var postElement = document.createElement('div');
        postElement.classList.add('card', 'mb-3');
        postElement.innerHTML = `
      <div class="card-body">
        <div class="d-flex">
          <img src="/images/avatar.jpg" class="rounded-circle" style="width: 50px;" alt="Profile Avatar">
          <div class="ml-3">
            <h5>${post.name}</h5>
            <p>${post.basicInfo}</p>
            <small>${new Date(post.createdAt).toLocaleString()}</small>
          </div>
        </div>
        <div class="mt-3">
          ${post.content}
        </div>
        <div class="mt-3">
          <button class="btn btn-sm btn-outline-primary">Like</button>
          <button class="btn btn-sm btn-outline-secondary">Comment</button>
        </div>
      </div>
    `;
        return postElement;
    }
</script>
</body>
</html>
